version: "3.7"
services:
  couchdb:
    image: "couchdb:2.3.0"
    hostname: couchdb1
    ports:
      - "5984:5984"
      - "5986:5986"
      - "4369:4369"
      - "9100-9200:9100-9200"
    environment:
      COUCHDB_COOKIE: "cookie"
      COUCHDB_USER: Admin
      COUCHDB_PASSWORD: admin
      NODENAME: "{{ansible_default_ipv4.address}}"
      COUCHDB_SECRET: "secret"
    volumes:
      - ./data:/opt/couchdb/data
    networks:
      couchdb_net:
        ipv4_address: "{{ansible_default_ipv4.address}}"

networks:
  couchdb_net:
    driver: overlay
    attachable: true
    # networks:
    #   - test_net
        # ipv4_address: 172.20.0.2

  # testdemo:
  #   build: ./dockerfile
  #   networks:
  #     - test_net
  #   links:
  #     - couchdb

# networks:
#   test_net:
#     driver: bridge
    # ipam:
    #   config:
    #     - subnet: 172.20.0.0/16


version: "3.7"
services:
  couchdb:
    image: "couchdb:2.3.0"
    hostname: master
    ports:
      - "5984:5984"
      - "5986:5986"
      - "4369:4369"
      - "9100-9200:9100-9200"
    environment:
      - ERL_FLAGS="-setcookie "cookie""
      - COUCHDB_USER=Admin
      - COUCHDB_PASSWORD=admin
      - NODENAME=45.113.233.94
      - COUCHDB_SECRET="secret"
    volumes:
      - ./data:/opt/couchdb/data


version: "3.7"
services:
  couchdb:
    image: "couchdb:2.3.0"
    hostname: slave
    ports:
      - "5984:5984"
      - "5986:5986"
      - "4369:4369"
      - "9100-9200:9100-9200"
    environment:
      - ERL_FLAGS="-setcookie "cookie""
      - COUCHDB_USER=Admin
      - COUCHDB_PASSWORD=admin
      - NODENAME=103.6.254.26
      - COUCHDB_SECRET="secret"
    volumes:
      - ./data:/opt/couchdb/data
#     networks:
#       couchdb_net:
#         ipv4_address: {{ ansible_default_ipv4.address }}
#
# networks:
#   couchdb_net:
#     driver: overlay
#     attachable: true
